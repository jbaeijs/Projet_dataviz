<html>
  <head>

    <!-- Lien vers la feuille de style -->
    <link href="css/main.css" rel="stylesheet">

    <!-- Chargement de la librairie pour traiter les données du fichier csv -->
    <script src="lib/papaparse.min.js"></script>

    <!-- Chargement de la librairie LeafLetJS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>

    <!-- Chargement du fichier .csv -->
    <input type="file" name="File Upload" id="txtFileUpload" accept=".csv" />

    <script type="text/javascript">

      // Tableau de correspondance des départements
      var COORD_DEPARTEMENTS = {
        "01": {
          "nom": "Ain",
          "latitude": 46.205,
          "longitude": 5.226,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "02": {
          "nom": "Aisne",
          "latitude": 49.569,
          "longitude": 3.626,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "03": {
          "nom": "Allier",
          "latitude": 46.567,
          "longitude": 3.626,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "04": {
          "nom": "Alpes de Hautes Provence",
          "latitude": 44.095,
          "longitude": 6.235,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "05": {
          "nom": "Hautes Alpes",
          "latitude": 44.558,
          "longitude": 6.076,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "06": {
          "nom": "Alpes Maritime",
          "latitude": 43.769,
          "longitude": 7.262,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "07": {
          "nom": "Ardeche",
          "latitude": 44.735,
          "longitude": 4.597,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "08": {
          "nom": "Ardennes",
          "latitude": 49.762,
          "longitude": 4.720,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "09": {
          "nom": "Ariege",
          "latitude": 42.959,
          "longitude": 1.608,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "10": {
          "nom": "Aube",
          "latitude": 48.296,
          "longitude": 4.071,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "11": {
          "nom": "Aude",
          "latitude": 43.216,
          "longitude": 2.348,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "13": {
          "nom": "Aveyron",
          "latitude": 44.353,
          "longitude": 2.571,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "14": {
          "nom": "Bouches du Rhone",
          "latitude": 43.296,
          "longitude": 5.369,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "15": {
          "nom": "Calvados",
          "latitude": 49.184,
          "longitude": -0.360,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "16": {
          "nom": "Cantal",
          "latitude": 44.926,
          "longitude": 2.444,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "17": {
          "nom": "Charente",
          "latitude": 45.652,
          "longitude": 0.154,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "18": {
          "nom": "Charente Maritime",
          "latitude": 46.161,
          "longitude": -1.151,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "19": {
          "nom": "Cher",
          "latitude": 47.080,
          "longitude": 2.396,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "20": {
          "nom": "Correze",
          "latitude": 45.263,
          "longitude": 1.768,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "21": {
          "nom": "Cote D'or",
          "latitude": 47.322,
          "longitude": 5.035,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "22": {
          "nom": "Cotes d'Armor",
          "latitude": 48.514,
          "longitude": -2.773,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "23": {
          "nom": "Creuse",
          "latitude": 45.185,
          "longitude": 1.874,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "24": {
          "nom": "Dordogne",
          "latitude": 45.185,
          "longitude": 0.721,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "25": {
          "nom": "Doubs",
          "latitude": 47.245,
          "longitude": 6.025,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "26": {
          "nom": "Drome",
          "latitude": 44.926,
          "longitude": 4.894,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "27": {
          "nom": "Eure",
          "latitude": 49.023,
          "longitude": 1.153,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "28": {
          "nom": "Eure et Loir",
          "latitude": 48.445,
          "longitude": 1.491,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "29": {
          "nom": "Finistere",
          "latitude": 47.994,
          "longitude": -4.109,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "2A": {
          "nom": "Corse du Sud",
          "latitude": 41.920,
          "longitude": 8.734,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "2B": {
          "nom": "Haute Corse",
          "latitude": 42.694,
          "longitude": 9.446,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "30": {
          "nom": "Gard",
          "latitude": 43.838,
          "longitude": 4.360,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "31": {
          "nom": "Haute Garonne",
          "latitude": 43.599,
          "longitude": 1.450,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "32": {
          "nom": "Gers",
          "latitude": 43.645,
          "longitude": 0.588,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "33": {
          "nom": "Gironde",
          "latitude": 44.843,
          "longitude": -0.574,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "34": {
          "nom": "Herault",
          "latitude": 43.608,
          "longitude": 3.874,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "35": {
          "nom": "Ille et Vilaine",
          "latitude": 48.107,
          "longitude": -1.680,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "36": {
          "nom": "Indre",
          "latitude": 46.811,
          "longitude": 1.698,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "37": {
          "nom": "Indre et Loire",
          "latitude": 47.392,
          "longitude": 0.683,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "38": {
          "nom": "Isere",
          "latitude": 45.185,
          "longitude": 5.722,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "39": {
          "nom": "Jura",
          "latitude": 46.672,
          "longitude": 5.552,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "40": {
          "nom": "Landes",
          "latitude": 43.981,
          "longitude": -0.501,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "41": {
          "nom": "Loir et Cher",
          "latitude": 47.588,
          "longitude": 1.327,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "42": {
          "nom": "Loire",
          "latitude": 45.440,
          "longitude": 4.389,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "43": {
          "nom": "Haute Loire",
          "latitude": 45.041,
          "longitude": 3.887,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "44": {
          "nom": "Loire Atlantique",
          "latitude": 47.226,
          "longitude": -1.551,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "45": {
          "nom": "Loiret",
          "latitude": 47.903,
          "longitude": 1.907,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "46": {
          "nom": "Lot",
          "latitude": 44.447,
          "longitude": 1.441,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "47": {
          "nom": "Lot et Garonne",
          "latitude": 44.207,
          "longitude": 0.621,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "48": {
          "nom": "Lozere",
          "latitude": 44.518,
          "longitude": 3.498,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "49": {
          "nom": "Maine et Loire",
          "latitude": 47.452,
          "longitude": -0.542,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "50": {
          "nom": "Manche",
          "latitude": 49.113,
          "longitude": -1.091,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "51": {
          "nom": "Marne",
          "latitude": 48.957,
          "longitude": 4.361,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "52": {
          "nom": "Haute Marne",
          "latitude": 48.110,
          "longitude": 5.139,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "53": {
          "nom": "Mayenne",
          "latitude": 48.071,
          "longitude": -0.773,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "54": {
          "nom": "Meurthe et Moselle",
          "latitude": 48.689,
          "longitude": 6.174,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "55": {
          "nom": "Meuse",
          "latitude": 48.771,
          "longitude": 5.172,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "56": {
          "nom": "Morbihan",
          "latitude": 47.654,
          "longitude": -2.760,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "57": {
          "nom": "Moselle",
          "latitude": 49.109,
          "longitude": 6.183,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "58": {
          "nom": "Nievre",
          "latitude": 46.994,
          "longitude": 3.155,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "59": {
          "nom": "Nord",
          "latitude": 50.628,
          "longitude": 3.044,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "60": {
          "nom": "Oise",
          "latitude": 49.435,
          "longitude": 2.081,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "61": {
          "nom": "Orne",
          "latitude": 48.433,
          "longitude": 0.088,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "62": {
          "nom": "Pas de Calais",
          "latitude": 50.289,
          "longitude": 2.767,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "63": {
          "nom": "Puy de Dome",
          "latitude": 45.779,
          "longitude": 3.085,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "64": {
          "nom": "Pyrenees Atlantiques",
          "latitude": 43.302,
          "longitude": -0.367,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "65": {
          "nom": "Hautes Pyrenees",
          "latitude": 43.233,
          "longitude": 0.071,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "66": {
          "nom": "Pyrenees Orientales",
          "latitude": 42.698,
          "longitude": 2.893,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "67": {
          "nom": "Bas Rhin",
          "latitude": 48.584,
          "longitude": 7.755,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "68": {
          "nom": "Haut Rhin",
          "latitude": 48.077,
          "longitude": 7.355,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "69": {
          "nom": "Rhone",
          "latitude": 45.766,
          "longitude": 4.835,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "70": {
          "nom": "Haute Saone",
          "latitude": 47.620,
          "longitude": 6.158,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "71": {
          "nom": "Saone et Loire",
          "latitude": 46.308,
          "longitude": 4.831,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "72": {
          "nom": "Sarthe",
          "latitude": 47.996,
          "longitude": 0.203,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "73": {
          "nom": "Savoie",
          "latitude": 45.571,
          "longitude": 5.918,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "74": {
          "nom": "Haute Savoie",
          "latitude": 45.906,
          "longitude": 6.126,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "75": {
          "nom": "Paris",
          "latitude": 48.856,
          "longitude": 2.351,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "76": {
          "nom": "Seine Maritime",
          "latitude": 49.437,
          "longitude": 1.089,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "77": {
          "nom": "Seine et Marne",
          "latitude": 48.540,
          "longitude": 2.657,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "78": {
          "nom": "Yvelines",
          "latitude": 48.806,
          "longitude": 2.136,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "79": {
          "nom": "Deux Sevres",
          "latitude": 46.324,
          "longitude": -0.462,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "80": {
          "nom": "Somme",
          "latitude": 49.894,
          "longitude": 2.293,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "81": {
          "nom": "Tarn",
          "latitude": 43.928,
          "longitude": 2.142,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "82": {
          "nom": "Tarn et Garonne",
          "latitude": 44.017,
          "longitude": 1.360,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "83": {
          "nom": "Var",
          "latitude": 43.126,
          "longitude": 5.933,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "84": {
          "nom": "Vaucluse",
          "latitude": 43.946,
          "longitude": 4.810,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "85": {
          "nom": "Vendee",
          "latitude": 46.672,
          "longitude": -1.429,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "86": {
          "nom": "Vienne",
          "latitude": 46.584,
          "longitude": 0.343,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "87": {
          "nom": "Haute Vienne",
          "latitude": 45.831,
          "longitude": 1.258,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "88": {
          "nom": "Vosges",
          "latitude": 48.176,
          "longitude": 6.447,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "89": {
          "nom": "Yonne",
          "latitude": 47.798,
          "longitude": 3.571,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "90": {
          "nom": "Territoire de Belfort",
          "latitude": 47.642,
          "longitude": 6.855,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "91": {
          "nom": "Essone",
          "latitude": 48.635,
          "longitude": 2.442,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "92": {
          "nom": "Hauts de Seine",
          "latitude": 48.890,
          "longitude": 2.208,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "93": {
          "nom": "Seine Saint Denis",
          "latitude": 48.907,
          "longitude": 2.441,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "94": {
          "nom": "Val de Marne",
          "latitude": 48.793,
          "longitude": 2.460,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        },
        "95": {
          "nom": "Val d'Oise",
          "latitude": 49.051,
          "longitude": 2.094,
          "fumeurs": 0,
          "total_personnes": 0,
          "dépressifs": 0
        }
      }


      // Variable de configuration :
      var DONNEES_PARSEES;

      // Variables de données utilisable par les graphiques :
      var NOMBRE_TOTAL_FUMEURS;
      var NOMBRE_PERSONNES_TOTALES;

      // Récupération du fichier sélectionné:
      document.getElementById('txtFileUpload').addEventListener('change', upload, false);

      // Stocker les données du fichier dans une varibale
      function upload(evt) {
        
        var data = null;
        var file = evt.target.files[0];
        var reader = new FileReader();
        reader.readAsText(file);
        reader.onload = function(event) {
          var csvData = event.target.result;
          var data = Papa.parse(csvData, {header : true});
          this.DONNEES_PARSEES = data;
          console.log(data);
          dataTreatment(data);
        };

        // En cas d'erreur: Avertir l'utilisateur
        reader.onerror = function() {
          alert('Unable to read ' + file.fileName);
        };
      }

      function dataTreatment(data){
        // Variables de traitement de données
        var nombreDePersonnesTotales = 0;
        var tableau_fumeurs_departements = {};

        // Extraction du nombre de fumeurs ou d'anciens fumeurs
        var nombreTotalDeFumeurs = 0;

        for (var i = 0; i < data.data.length; i++){
            if (data.data[i].FDR_tabagismeAncien == "1"){
                nombreTotalDeFumeurs++;
                for (var key in this.COORD_DEPARTEMENTS){
                  if (key == data.data[i].CHA_id_departement_P){
                    COORD_DEPARTEMENTS[key].fumeurs++;
                  }
                }
            }
            nombreDePersonnesTotales++;
        }
        console.log(this.COORD_DEPARTEMENTS);
        this.initMap();
      }

      function dataTreatment2(){
        
      }

      function initMap(){
        var mymap = L.map('mapid').setView([46.345, 2.598], 6);
        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(mymap);
      }
    </script>
  </head>

  <body>
    <!--Div that will hold the pie chart-->
    <div class="chart_container">
      <div id="mapid" style="height:700px"></div>
    </div>

    </body>
</html>