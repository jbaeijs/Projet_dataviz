<html>
  <head>

    <!-- Lien vers la feuille de style -->
    <link href="css/main.css" rel="stylesheet">

    <!-- Chargement de la librairie pour traiter les données du fichier csv -->
    <script src="lib/papaparse.min.js"></script>

    <!-- Chargement de la librairie LeafLetJS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>

    <!-- Chargement du fichier .csv -->
    <input type="file" name="File Upload" id="txtFileUpload" accept=".csv" />

    <script type="text/javascript">

      // Variable de configuration :
      var DONNEES_PARSEES;

      // Variables de données utilisable par les graphiques :
      var NOMBRE_TOTAL_FUMEURS;
      var NOMBRE_PERSONNES_TOTALES;

      // Récupération du fichier sélectionné:
      document.getElementById('txtFileUpload').addEventListener('change', upload, false);

      // Stocker les données du fichier dans une varibale
      function upload(evt) {
        
        var data = null;
        var file = evt.target.files[0];
        var reader = new FileReader();
        reader.readAsText(file);
        reader.onload = function(event) {
          var csvData = event.target.result;
          var data = Papa.parse(csvData, {header : true});
          this.DONNEES_PARSEES = data;
          console.log(data);
          
          // Fonction de nettoyage des données
          dataExtractor(data)
        };

        // En cas d'erreur: Avertir l'utilisateur
        reader.onerror = function() {
          alert('Unable to read ' + file.fileName);
        };
      }

      function dataExtractor(data){
        var nombreDePersonnesTotales = 0;

        // Extraction du nombre de fumeurs ou d'anciens fumeurs
        var nombreTotalDeFumeurs = 0;
        for (var i = 0; i < data.data.length; i++){
            if (data.data[i].FDR_tabagismeAncien == "1"){
                nombreTotalDeFumeurs++;
            }
            nombreDePersonnesTotales++;
        }
        this.NOMBRE_PERSONNES_TOTALES = nombreDePersonnesTotales;
        this.NOMBRE_TOTAL_FUMEURS = nombreTotalDeFumeurs;
        this.initMap();
      }

      function initMap(){
        var mymap = L.map('mapid').setView([46.345, 2.598], 6);
        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(mymap);
      }
    </script>
  </head>

  <body>
    <!--Div that will hold the pie chart-->
    <div class="chart_container">
      <div id="mapid" style="height:700px"></div>
    </div>

    </body>
</html>